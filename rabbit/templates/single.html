<!DOCTYPE HTML>
<html>
	<head>
		<title>Single article</title>
		<meta charset="utf-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no" />
		<link rel="stylesheet" href="{{ url_for('static', filename='assets/css/main.css') }}" />
	</head>
	<body class="single is-preload">
		<!-- edit -->
		<div id="editPostModal" class="modal" style="display: none;">
    		<div>
        		<span id="closeEditModalBtn" class="close-btn">&times;</span>
        		<h2>編輯文章</h2>
        
        		{% if article %}
        		<form method="POST" action="{{ url_for('edit_post', article_id=article[0]) }}">
            
            		<label for="editPostTitle">標題:</label>
            		<input type="text" id="editPostTitle" name="title" value="{{ article[1] }}" required><br><br>

            		<label for="editPostContent">內容:</label>
            		<textarea id="editPostContent" name="content" rows="10" required>{{ article[2] }}</textarea><br><br>

            		<label for="editPostCategory">種類:</label>
            		<select id="editPostCategory" name="category" required>
                		<option value="Food" {% if article[5] == 'Food' %}selected{% endif %}>Food</option>
                		<option value="Sports" {% if article[5] == 'Sports' %}selected{% endif %}>Sports</option>
                		<option value="Technology" {% if article[5] == 'Technology' %}selected{% endif %}>Technology</option>
                		<option value="Other" {% if article[5] == 'Other' %}selected{% endif %}>Other</option>
            		</select><br><br>

            		<button type="submit">確認修改</button>
        		</form>
        		{% else %}
        		<p>無法載入編輯表單，文章不存在。</p>
        		{% endif %}

    		</div>
		</div>

		<div id="wrapper">
			<a href="{{ url_for('index') }}" class="button primary icon solid fa-home" style="margin-bottom: 2em; margin-left: 2em; display: inline-block;">
        	回首頁
    		</a>
				<!-- post -->
				<div id="main">
        			{% if article %}  
					<article class="post">
            			<header>
                			<div class="title">
                    			<h2 class="article-content">{{ article[1] }}</h2>
                			</div>
                			<div class="meta">
                    			<time class="published" datetime="{{ article[4] }}">{{ article[4] }}</time>
                    			<a href="{{ url_for('author_posts', author_name=article[3]) }}" class="author"><span class="name">{{ article[3] }}</span></a>
                			</div>
            			</header>
            			<p class="article-content">{{ article[2] | safe }}</p>
            			<footer>
                			<ul class="stats">
                    			<li>{{ article[5] }}</li>
                    			<li><a href="#" class="icon solid fa-comment">{{ comments | length if comments else 0 }}</a></li>
								{% if username and username == article[3] %}
        						<li>
           							 <a href="#" id="editPostButton" class="icon solid fa-edit">修改</a>
        						</li>
        						<li>
            						<a href="{{ url_for('delete_post', article_id=article[0]) }}" class="icon solid fa-trash">刪除</a>
        						</li>
    							{% endif %}
                			</ul>
            			</footer>
        			</article>
        			{% else %}
        			<p>找不到該文章或文章 ID 錯誤。</p>
        			{% endif %}
    			</div>

				<!-- comment -->
				<div class="comment-section">
					<form method="POST" action="{{ url_for('post_comment', article_id=article[0]) }}"></form>
    				{% if username %}
					<h4>以 {{ username }} 身份留言</h4>
    				{% else %}
					<h4>以 訪客 身份留言</h4>
    				{% endif %}
					<textarea name="comment_content" rows="4" placeholder="輸入您的評論..." required></textarea>
						<div class="form-actions"> 
							<button type="submit" class="button special small">送出評論</button>
						</div>
					</form>

    				{% if comments %}
        			{% for comment in comments %}
        			<article class="comment-box">
            			<header>
                			<div class="meta">
                    		<span class="author-name">
                        		<a href="{{ url_for('author_posts', author_name=comment[1]) }}">{{ comment[1] }}</a>
                    		</span>
                    			<time class="published">{{ comment[3] }}</time>
                			</div>
            			</header>
            			<p>{{ comment[2] }}</p>
        			</article>
        			<hr> {% endfor %}
    				{% else %}
        			<p>目前沒有評論。快來搶第一個留言吧！</p>
    				{% endif %}
				</div>

		<!-- Scripts -->
			<script src="{{ url_for('static', filename='assets/js/main.js') }}"></script>
	</body>
</html>